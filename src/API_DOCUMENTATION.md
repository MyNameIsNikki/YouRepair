# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã "–í–∞—à–†–µ–º–æ–Ω—Ç"

> **üî• –ù–û–í–ò–ù–ö–ê:** –ü—Ä–æ–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL! –°–º. [`/POSTGRES_README.md`](./POSTGRES_README.md) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.
>
> **–≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π KV-based API.** –î–ª—è PostgreSQL API —Å–º. [`/POSTGRES_INTEGRATION_GUIDE.md`](./POSTGRES_INTEGRATION_GUIDE.md).

## –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**Base URL:** `https://{projectId}.supabase.co/functions/v1/make-server-ee694789`

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer {token}`

–î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `publicAnonKey`. –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `access_token`, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –ø—Ä–∏ –≤—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**POST** `/signup`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.

**Body:**
```json
{
  "email": "user@example.com",
  "password": "securePassword123",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "userType": "client" // –∏–ª–∏ "brigade"
}
```

**Response:**
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "userType": "client"
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Email –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ email-—Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω.

---

### –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í—Ö–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Supabase SDK:

```javascript
import { createClient } from '@supabase/supabase-js';

const supabase = createClient(supabaseUrl, supabaseAnonKey);
const { data: { session }, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password'
});

const accessToken = session?.access_token;
// –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ accessToken –≤ localStorage –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
```

---

## –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

**GET** `/profile`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Response:**
```json
{
  "id": "uuid",
  "email": "user@example.com",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "userType": "client",
  "phone": "+7 (999) 123-45-67",
  "company": "–û–û–û –°—Ç—Ä–æ–π"
}
```

---

### –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

**PUT** `/profile`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Body:**
```json
{
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "phone": "+7 (999) 123-45-67",
  "company": "–û–û–û –°—Ç—Ä–æ–π"
}
```

**Response:**
```json
{
  "success": true,
  "profile": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
    "userType": "client",
    "phone": "+7 (999) 123-45-67",
    "company": "–û–û–û –°—Ç—Ä–æ–π"
  }
}
```

---

## –ó–∞—è–≤–∫–∏ –Ω–∞ –¥–µ–º–æ (Lead Capture)

### –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –¥–µ–º–æ

**POST** `/demo-requests`

–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –ª–∏–¥–æ–≤ —Å –ª–µ–Ω–¥–∏–Ω–≥–∞.

**Body:**
```json
{
  "name": "–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤",
  "email": "petr@example.com",
  "phone": "+7 (999) 999-99-99",
  "userType": "client",
  "message": "–•–æ—á—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ"
}
```

**Response:**
```json
{
  "success": true,
  "message": "–ó–∞—è–≤–∫–∞ –Ω–∞ –¥–µ–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!",
  "requestId": "demo_1234567890_abc123"
}
```

---

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞—è–≤–∫–∏

**GET** `/demo-requests`

–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–±—É–¥—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è).

**Response:**
```json
{
  "success": true,
  "requests": [
    {
      "id": "demo_1234567890_abc123",
      "name": "–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤",
      "email": "petr@example.com",
      "phone": "+7 (999) 999-99-99",
      "userType": "client",
      "message": "–•–æ—á—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ",
      "status": "new",
      "createdAt": "2026-02-07T10:00:00.000Z"
    }
  ],
  "total": 1
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/apartments`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Response:**
```json
{
  "success": true,
  "apartments": [
    {
      "id": "apt_1234567890_abc123",
      "userId": "uuid",
      "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ47",
      "address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 47",
      "totalArea": 85,
      "rooms": ["room_id_1", "room_id_2"],
      "createdAt": "2026-02-07T10:00:00.000Z",
      "updatedAt": "2026-02-07T10:00:00.000Z"
    }
  ]
}
```

---

### –ü–æ–ª—É—á–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É –ø–æ ID

**GET** `/apartments/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–≤–∞—Ä—Ç–∏—Ä–µ.

**Response:**
```json
{
  "success": true,
  "apartment": {
    "id": "apt_1234567890_abc123",
    "userId": "uuid",
    "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ47",
    "address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 47",
    "totalArea": 85,
    "rooms": ["room_id_1", "room_id_2"],
    "createdAt": "2026-02-07T10:00:00.000Z",
    "updatedAt": "2026-02-07T10:00:00.000Z"
  }
}
```

---

### –°–æ–∑–¥–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É

**POST** `/apartments`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Body:**
```json
{
  "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ47",
  "address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 47",
  "totalArea": 85
}
```

**Response:**
```json
{
  "success": true,
  "apartment": {
    "id": "apt_1234567890_abc123",
    "userId": "uuid",
    "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ47",
    "address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 47",
    "totalArea": 85,
    "rooms": [],
    "createdAt": "2026-02-07T10:00:00.000Z",
    "updatedAt": "2026-02-07T10:00:00.000Z"
  }
}
```

---

### –û–±–Ω–æ–≤–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É

**PUT** `/apartments/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–≤–∞—Ä—Ç–∏—Ä–µ.

**Body:**
```json
{
  "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ48",
  "address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 48",
  "totalArea": 90
}
```

**Response:**
```json
{
  "success": true,
  "apartment": {
    "id": "apt_1234567890_abc123",
    "userId": "uuid",
    "name": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ48",
    "address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 48",
    "totalArea": 90,
    "rooms": ["room_id_1", "room_id_2"],
    "createdAt": "2026-02-07T10:00:00.000Z",
    "updatedAt": "2026-02-07T11:00:00.000Z"
  }
}
```

---

### –£–¥–∞–ª–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É

**DELETE** `/apartments/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–≤–∞—Ä—Ç–∏—Ä–µ.

**Response:**
```json
{
  "success": true,
  "message": "Apartment deleted successfully"
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–æ–º–Ω–∞—Ç—ã –∫–≤–∞—Ä—Ç–∏—Ä—ã

**GET** `/apartments/:apartmentId/rooms`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–≤–∞—Ä—Ç–∏—Ä–µ.

**Response:**
```json
{
  "success": true,
  "rooms": [
    {
      "id": "room_1234567890_abc123",
      "apartmentId": "apt_id",
      "name": "–ì–æ—Å—Ç–∏–Ω–∞—è",
      "area": 25,
      "image": "https://...",
      "tasks": ["task_id_1", "task_id_2"],
      "createdAt": "2026-02-07T10:00:00.000Z",
      "updatedAt": "2026-02-07T10:00:00.000Z"
    }
  ]
}
```

---

### –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É –ø–æ ID

**GET** `/rooms/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Response:**
```json
{
  "success": true,
  "room": {
    "id": "room_1234567890_abc123",
    "apartmentId": "apt_id",
    "name": "–ì–æ—Å—Ç–∏–Ω–∞—è",
    "area": 25,
    "image": "https://...",
    "tasks": ["task_id_1", "task_id_2"],
    "createdAt": "2026-02-07T10:00:00.000Z",
    "updatedAt": "2026-02-07T10:00:00.000Z"
  }
}
```

---

### –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É

**POST** `/apartments/:apartmentId/rooms`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–≤–∞—Ä—Ç–∏—Ä–µ.

**Body:**
```json
{
  "name": "–ì–æ—Å—Ç–∏–Ω–∞—è",
  "area": 25,
  "image": "https://..."
}
```

**Response:**
```json
{
  "success": true,
  "room": {
    "id": "room_1234567890_abc123",
    "apartmentId": "apt_id",
    "name": "–ì–æ—Å—Ç–∏–Ω–∞—è",
    "area": 25,
    "image": "https://...",
    "tasks": [],
    "createdAt": "2026-02-07T10:00:00.000Z",
    "updatedAt": "2026-02-07T10:00:00.000Z"
  }
}
```

---

### –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É

**PUT** `/rooms/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Body:**
```json
{
  "name": "–ì–æ—Å—Ç–∏–Ω–∞—è –±–æ–ª—å—à–∞—è",
  "area": 30,
  "image": "https://..."
}
```

---

### –£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É

**DELETE** `/rooms/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Response:**
```json
{
  "success": true,
  "message": "Room deleted successfully"
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –∫–æ–º–Ω–∞—Ç—ã

**GET** `/rooms/:roomId/tasks`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Response:**
```json
{
  "success": true,
  "tasks": [
    {
      "id": "task_1234567890_abc123",
      "roomId": "room_id",
      "name": "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞",
      "description": "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞ 33 –∫–ª–∞—Å—Å–∞",
      "status": "completed",
      "assignedTo": "–ò–≤–∞–Ω–æ–≤ –ê.–°.",
      "dueDate": "2026-01-10",
      "materials": ["mat_id_1", "mat_id_2"],
      "media": ["media_id_1"],
      "createdAt": "2026-02-07T10:00:00.000Z",
      "updatedAt": "2026-02-07T10:00:00.000Z"
    }
  ]
}
```

**–°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á:** `pending`, `in-progress`, `completed`, `review`

---

### –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É –ø–æ ID

**GET** `/tasks/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

---

### –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É

**POST** `/rooms/:roomId/tasks`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Body:**
```json
{
  "name": "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞",
  "description": "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞ 33 –∫–ª–∞—Å—Å–∞, –ø–ª–æ—â–∞–¥—å 25 –∫–≤.–º.",
  "assignedTo": "–ò–≤–∞–Ω–æ–≤ –ê.–°.",
  "dueDate": "2026-01-10",
  "status": "pending"
}
```

---

### –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É

**PUT** `/tasks/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ –∏ –¥—Ä—É–≥–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**Body:**
```json
{
  "status": "in-progress",
  "assignedTo": "–ü–µ—Ç—Ä–æ–≤ –í.–ò.",
  "dueDate": "2026-01-15"
}
```

---

### –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É

**DELETE** `/tasks/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞–¥–∞—á–∏

**GET** `/tasks/:taskId/materials`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Response:**
```json
{
  "success": true,
  "materials": [
    {
      "id": "mat_1234567890_abc123",
      "taskId": "task_id",
      "name": "–õ–∞–º–∏–Ω–∞—Ç 33 –∫–ª–∞—Å—Å, –¥—É–±",
      "quantity": "27 –∫–≤.–º",
      "price": 45900,
      "receipt": "–ß–µ–∫ ‚Ññ12345 –æ—Ç 05.01.2026",
      "purchaseDate": "2026-01-05",
      "createdAt": "2026-02-07T10:00:00.000Z"
    }
  ]
}
```

---

### –°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª

**POST** `/tasks/:taskId/materials`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Body:**
```json
{
  "name": "–õ–∞–º–∏–Ω–∞—Ç 33 –∫–ª–∞—Å—Å, –¥—É–±",
  "quantity": "27 –∫–≤.–º",
  "price": 45900,
  "receipt": "–ß–µ–∫ ‚Ññ12345 –æ—Ç 05.01.2026",
  "purchaseDate": "2026-01-05"
}
```

---

### –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª

**PUT** `/materials/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

---

### –£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª

**DELETE** `/materials/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã –∑–∞–¥–∞—á–∏

**GET** `/tasks/:taskId/media`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ URL —Å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ 1 —á–∞—Å.

**Response:**
```json
{
  "success": true,
  "media": [
    {
      "id": "media_1234567890_abc123",
      "taskId": "task_id",
      "type": "photo",
      "url": "https://...signed-url...",
      "storagePath": "user_id/task_id/filename.jpg",
      "uploadedBy": "–ò–≤–∞–Ω–æ–≤ –ê.–°.",
      "uploadDate": "2026-01-08",
      "createdAt": "2026-02-07T10:00:00.000Z"
    }
  ]
}
```

**–¢–∏–ø—ã –º–µ–¥–∏–∞:** `photo`, `video`

---

### –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª

**POST** `/tasks/:taskId/media/upload`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç FormData.

**FormData fields:**
- `file`: File (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `type`: "photo" –∏–ª–∏ "video" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
const formData = new FormData();
formData.append('file', fileObject);
formData.append('type', 'photo');

const response = await fetch(url, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
  },
  body: formData,
});
```

**Response:**
```json
{
  "success": true,
  "media": {
    "id": "media_1234567890_abc123",
    "taskId": "task_id",
    "type": "photo",
    "url": "https://...signed-url...",
    "storagePath": "user_id/task_id/filename.jpg",
    "uploadedBy": "–ò–≤–∞–Ω–æ–≤ –ê.–°.",
    "uploadDate": "2026-02-07",
    "createdAt": "2026-02-07T10:00:00.000Z"
  }
}
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 50 –ú–ë
- –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º bucket: `make-ee694789-media`
- URL –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ 1 —á–∞—Å

---

### –£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞—Ñ–∞–π–ª

**DELETE** `/media/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ Storage –∏ –∑–∞–ø–∏—Å—å –∏–∑ –±–∞–∑—ã.

---

## –°–∏—Å—Ç–µ–º–∞ —Ç–∏–∫–µ—Ç–æ–≤ (–ü–æ–¥–¥–µ—Ä–∂–∫–∞)

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–∏–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/tickets`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Response:**
```json
{
  "success": true,
  "tickets": [
    {
      "id": "ticket_1234567890_abc123",
      "userId": "uuid",
      "subject": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ",
      "message": "–ù–µ –º–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏",
      "priority": "medium",
      "status": "open",
      "messages": [],
      "createdAt": "2026-02-07T10:00:00.000Z",
      "updatedAt": "2026-02-07T10:00:00.000Z"
    }
  ]
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:** `low`, `medium`, `high`  
**–°—Ç–∞—Ç—É—Å—ã:** `open`, `in-progress`, `resolved`, `closed`

---

### –ü–æ–ª—É—á–∏—Ç—å —Ç–∏–∫–µ—Ç –ø–æ ID

**GET** `/tickets/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

---

### –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç

**POST** `/tickets`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Body:**
```json
{
  "subject": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ",
  "message": "–ù–µ –º–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –∑–∞–¥–∞—á—É",
  "priority": "medium"
}
```

---

### –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–∫–µ—Ç

**PUT** `/tickets/:id`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

**Body:**
```json
{
  "status": "in-progress",
  "priority": "high"
}
```

---

### –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫ —Ç–∏–∫–µ—Ç—É

**POST** `/tickets/:id/messages`

–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –¥–æ—Å—Ç—É–ø–∞.

**Body:**
```json
{
  "message": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–µ"
}
```

**Response:**
```json
{
  "success": true,
  "ticket": {
    "id": "ticket_1234567890_abc123",
    "userId": "uuid",
    "subject": "–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ",
    "message": "–ù–µ –º–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏",
    "priority": "medium",
    "status": "open",
    "messages": [
      {
        "id": "msg_1234567890_abc123",
        "sender": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "senderId": "uuid",
        "message": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –ø—Ä–æ–±–ª–µ–º–µ",
        "timestamp": "2026-02-07T11:00:00.000Z"
      }
    ],
    "createdAt": "2026-02-07T10:00:00.000Z",
    "updatedAt": "2026-02-07T11:00:00.000Z"
  }
}
```

---

## Health Check

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API

**GET** `/health`

–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**Response:**
```json
{
  "status": "ok",
  "timestamp": "2026-02-07T10:00:00.000Z"
}
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "error": "Detailed error message"
}
```

**HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã:**
- `200` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏

```javascript
// 1. –°–æ–∑–¥–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
const { apartment } = await apartmentAPI.create({
  name: "–ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Ññ47",
  address: "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –¥. 12, –∫–≤. 47",
  totalArea: 85
});

// 2. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
const { room } = await roomAPI.create(apartment.id, {
  name: "–ì–æ—Å—Ç–∏–Ω–∞—è",
  area: 25,
  image: "https://..."
});

// 3. –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É
const { task } = await taskAPI.create(room.id, {
  name: "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞",
  description: "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞ 33 –∫–ª–∞—Å—Å–∞",
  assignedTo: "–ò–≤–∞–Ω–æ–≤ –ê.–°.",
  dueDate: "2026-01-10",
  status: "pending"
});

// 4. –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
const { material } = await materialAPI.create(task.id, {
  name: "–õ–∞–º–∏–Ω–∞—Ç 33 –∫–ª–∞—Å—Å, –¥—É–±",
  quantity: "27 –∫–≤.–º",
  price: 45900,
  receipt: "–ß–µ–∫ ‚Ññ12345 –æ—Ç 05.01.2026",
  purchaseDate: "2026-01-05"
});

// 5. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
const { media } = await mediaAPI.upload(task.id, fileObject, 'photo');

// 6. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
await taskAPI.update(task.id, { status: 'completed' });
```

---

### –ü—Ä–∏–º–µ—Ä 2: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ –¥–µ–º–æ —Å –ª–µ–Ω–¥–∏–Ω–≥–∞

```javascript
const response = await demoRequestAPI.create({
  name: "–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤",
  email: "petr@example.com",
  phone: "+7 (999) 999-99-99",
  userType: "client",
  message: "–•–æ—á—É –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–º–æ"
});

console.log(response.message); // "–ó–∞—è–≤–∫–∞ –Ω–∞ –¥–µ–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!"
```

---

### –ü—Ä–∏–º–µ—Ä 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

```javascript
// –°–æ–∑–¥–∞—Ç—å —Ç–∏–∫–µ—Ç
const { ticket } = await ticketAPI.create({
  subject: "–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–æ—Ç–æ",
  message: "–ù–µ –º–æ–≥—É –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –∑–∞–¥–∞—á—É",
  priority: "medium"
});

// –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
await ticketAPI.addMessage(ticket.id, "–ü—Ä–æ–±–æ–≤–∞–ª —á–µ—Ä–µ–∑ Chrome –∏ Safari");

// –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
await ticketAPI.update(ticket.id, { status: "in-progress" });
```

---

## –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **SUPABASE_SERVICE_ROLE_KEY** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É
2. –í—Å–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `getAuthenticatedUser()`
3. –î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `userId` –≤–ª–∞–¥–µ–ª—å—Ü–∞
4. –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º bucket —Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ URL

### Storage

- Bucket name: `make-ee694789-media`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤: `{userId}/{taskId}/{timestamp}_{random}.{ext}`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: 50 –ú–ë
- –ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ URL –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 1 —á–∞—Å

### KV Store

–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ key-value —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∫–ª—é—á–µ–π:

- `profile:{userId}` - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `demo_request:{requestId}` - –∑–∞—è–≤–∫–∞ –Ω–∞ –¥–µ–º–æ
- `demo_requests_index` - –º–∞—Å—Å–∏–≤ ID –≤—Å–µ—Ö –∑–∞—è–≤–æ–∫
- `user_apartments:{userId}` - –º–∞—Å—Å–∏–≤ ID –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `apartment:{apartmentId}` - –¥–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã
- `room:{roomId}` - –¥–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã
- `task:{taskId}` - –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
- `material:{materialId}` - –¥–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- `media:{mediaId}` - –¥–∞–Ω–Ω—ã–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞
- `user_tickets:{userId}` - –º–∞—Å—Å–∏–≤ ID —Ç–∏–∫–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `ticket:{ticketId}` - –¥–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ç–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `console.error` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Supabase Dashboard.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ API –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Supabase:
- [Supabase Auth](https://supabase.com/docs/guides/auth)
- [Supabase Storage](https://supabase.com/docs/guides/storage)
- [Edge Functions](https://supabase.com/docs/guides/functions)